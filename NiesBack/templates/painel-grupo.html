{% extends "base.html" %}
{% block content %}
<style>
  /* Container da thumb: define o "retângulo padrão" da imagem */
.report-thumb-wrapper {
  width: 100%;
  aspect-ratio: 16 / 9;  /* todos os thumbs 16:9 */
  overflow: hidden;
  border-radius: 8px;
}

/* Imagem preenche o container sem distorcer */
.report-thumb {
  width: 100%;
  
  max-height: 100%;
  object-fit: cover;      /* corta o que sobra, mas não deforma */
  display: block;
}

</style>


<!-- vendors -->
<script src="{{ request.app.url_path_for('static', path='assets/vendors/js/vendor.bundle.base.js') }}"></script>

<!-- plugins da página (se seu tema usar) -->
<script src="{{ request.app.url_path_for('static', path='assets/vendors/chart.js/Chart.min.js') }}"></script>
<script src="{{ request.app.url_path_for('static', path='assets/vendors/progressbar.js/progressbar.min.js') }}"></script>
<script src="{{ request.app.url_path_for('static', path='assets/vendors/jvectormap/jquery-jvectormap.min.js') }}"></script>
<script src="{{ request.app.url_path_for('static', path='assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js') }}"></script>
<script src="{{ request.app.url_path_for('static', path='assets/vendors/owl-carousel-2/owl.carousel.min.js') }}"></script>

<!-- scripts principais do template (precisam para o collapse funcionar) -->
<script src="{{ request.app.url_path_for('static', path='assets/js/off-canvas.js') }}"></script>
<script src="{{ request.app.url_path_for('static', path='assets/js/hoverable-collapse.js') }}"></script>
<script src="{{ request.app.url_path_for('static', path='assets/js/misc.js') }}"></script>
<script src="{{ request.app.url_path_for('static', path='assets/js/settings.js') }}"></script>
<script src="{{ request.app.url_path_for('static', path='assets/js/todolist.js') }}"></script>

<!-- seus scripts -->
<script src="{{ request.app.url_path_for('static', path='assets/js/logout.js') }}"></script>


<div class="main-panel">
  <div class="content-wrapper">

    <!-- Breadcrumb -->
    <div class="page-header">
      <h3 class="page-title">
        {% for b in breadcrumb %}
          {% if not loop.first %} &raquo; {% endif %}
          <a href="/grupo/{{ b.id }}">{{ b.name }}</a>
        {% endfor %}
      </h3>
    </div>

    <!-- Subgrupos -->
    {% if subgrupos and subgrupos|length > 0 %}
    <div class="row">
      <div class="col-12 mb-3">
        <h4 class="card-title">Subgrupos</h4>
      </div>
      {% for sg in subgrupos %}
      <div class="col-md-4 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{{ sg.name }}</h5>
            <p class="card-text text-muted">Clique para ver os painéis deste subgrupo.</p>
            <a class="btn btn-outline-primary" href="/grupo/{{ sg.id }}">Ver subgrupo</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Relatórios do grupo -->
    <div class="row">
      <div class="col-12 mb-3">
        <h4 class="card-title">Painéis do grupo: {{ grupo.name }}</h4>
      </div>

      {% if reports and reports|length > 0 %}
        {% for r in reports %}
                  <div class="col-md-6 col-xl-4 grid-margin stretch-card">
                    <div class="card h-100">
                      <div class="card-body">
                      <h4 class="card-title">{{ r.name }}</h4>
                      <!-- se tiver thumbnail_url absoluto usa ele; senão usa fallback local -->
                    {% set thumb = r.image_url if r.image_url else request.app.url_path_for('static', path='assets/images/dashboard/1.png') %}
                      <a href="/report/{{ r.id }}">
                        <div class="report-thumb-wrapper">
                          <img src="{{ thumb }}" alt="{{ r.name }}" class="report-thumb">
                        </div>
                      </a>
                      <div class="d-flex py-4">
                        <div class="flex-grow">
                          <div class="d-flex d-md-block d-xl-flex justify-content-between">
                            <h6 class="preview-subject">Este Painel Monitora</h6>
                             {% set privacy_class = 'text-success' if r.is_public else 'text-warning' %}
                              <p class="text-small {{ privacy_class }}">
                              {{ 'Público' if r.is_public else 'Privado' }}
                              </p>
                          </div>
                          <p class="text-muted">
                            {{ r.title_description or r.description or "Sem descrição" }}
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
        {% endfor %}
      {% else %}
        <div class="col-12">
          <div class="alert alert-info">Nenhum painel disponível neste grupo.</div>
        </div>
      {% endif %}
    </div>

  </div>
</div>

{% endblock %}
